<!DOCTYPE html>
<html>

<head>
	<title>Etheart - Heartbeat of Ethereum</title>
	<script type="text/javascript" src="static/js/jquery-3.2.1.min.js"></script>
	<script src="static/js/d3.v4.min.js"></script>
	<link rel="stylesheet" type="text/css" href="static/css/index.css">
</head>

<body>
	<div class="chart">
	</div>
	<script src="src/circularHeatChart.js"></script>
	<script type="text/javascript">
	var width = 800;
	var height = 600;

	var chart = circularHeatChart()
		.segmentHeight(20)
		.innerRadius(20);


	var svg = d3.select('.chart')
		.insert('svg')

	// setInterval(function() {	}, 1500);

	var lastDate = "";

	function prefetch() {
		$.getJSON('https://api.bithumb.com/public/recent_transactions/ETH', {
				count: 100
			},
			function(data) {
				if (data === null) setTimeout(prefetch, 1000);

				if (data.data[0].transaction_date != lastDate) {
					lastDate = data.data[0].transaction_date;

					var arr = [];
					for (var i = 0; i < 100; i++) arr[i] = data.data[i].total / 100000;

					svg.data([arr])
						.attr("width", width)
						.attr("height", height)
						.call(chart);

					console.log(data.data[0].transaction_date);
				}

				setTimeout(prefetch, 1000);
			});
	}
	prefetch();
	</script>
</body>

</html>